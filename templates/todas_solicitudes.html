<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todas las Solicitudes - Sistema de Análisis Crediticio</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        
        .card-custom {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
        }
        
        .filter-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(102,126,234,0.3);
        }
        
        .stats-overview {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(252,182,159,0.3);
        }
        
        .status-badge {
            font-size: 0.8em;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-aprobado { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb;
        }
        
        .status-rechazado { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb;
        }
        
        .status-zona_gris { 
            background: #fff3cd; 
            color: #856404; 
            border: 1px solid #faeeba;
        }
        
        .status-en_proceso { 
            background: #d1ecf1; 
            color: #0c5460; 
            border: 1px solid #bee5eb;
        }
        
        .table-actions .btn {
            margin: 1px;
            padding: 4px 8px;
            font-size: 0.8em;
            border-radius: 8px;
        }
        
        .analista-badge {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            color: #495057;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            border: 1px solid #ced4da;
        }
        
        .form-control-custom {
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.2);
            color: white;
            backdrop-filter: blur(5px);
        }
        
        .form-control-custom::placeholder {
            color: rgba(255,255,255,0.7);
        }
        
        .form-control-custom:focus {
            border-color: rgba(255,255,255,0.5);
            box-shadow: 0 0 0 0.25rem rgba(255,255,255,0.25);
            background: rgba(255,255,255,0.3);
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(102,126,234,0.05);
            transform: translateY(-1px);
            transition: all 0.3s ease;
        }
        
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 30px;
            padding: 15px;
            background: rgba(102,126,234,0.05);
            border-radius: 10px;
            border-left: 3px solid #667eea;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -22px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @media (max-width: 768px) {
            .table-responsive {
                font-size: 0.85em;
            }
            
            .filter-card .row {
                gap: 10px;
            }
            
            .stats-overview .col-md-2 {
                margin-bottom: 15px;
            }
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .search-highlight {
            background-color: #fff3cd !important;
            animation: highlight 2s ease-in-out;
        }
        
        @keyframes highlight {
            0% { background-color: #ffc107; }
            100% { background-color: #fff3cd; }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row mb-4 fade-in">
            <div class="col-12">
                <div class="card card-custom">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h1 class="mb-1">
                                    <i class="fas fa-folder-open text-primary me-3"></i>
                                    Todas las Solicitudes del Sistema
                                </h1>
                                <p class="text-muted mb-0">
                                    Vista administrativa completa de solicitudes crediticias
                                </p>
                            </div>
                            <div class="col-md-4 text-end">
                                <button onclick="exportarDatos()" class="btn btn-success me-2">
                                    <i class="fas fa-download me-2"></i>Exportar
                                </button>
                                <button onclick="window.history.back()" class="btn btn-outline-secondary">
                                    <i class="fas fa-arrow-left me-2"></i>Panel Admin
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estadísticas Generales -->
        <div class="stats-overview fade-in">
            <div class="row text-center">
                <div class="col-md-2 col-6 mb-3 mb-md-0">
                    <h3 class="text-primary" id="totalSolicitudes">156</h3>
                    <p class="mb-0 fw-bold">Total</p>
                </div>
                <div class="col-md-2 col-6 mb-3 mb-md-0">
                    <h3 class="text-success" id="aprobadas">89</h3>
                    <p class="mb-0 fw-bold">Aprobadas</p>
                </div>
                <div class="col-md-2 col-6 mb-3 mb-md-0">
                    <h3 class="text-danger" id="rechazadas">23</h3>
                    <p class="mb-0 fw-bold">Rechazadas</p>
                </div>
                <div class="col-md-2 col-6 mb-3 mb-md-0">
                    <h3 class="text-warning" id="zonaGris">12</h3>
                    <p class="mb-0 fw-bold">Zona Gris</p>
                </div>
                <div class="col-md-2 col-6 mb-3 mb-md-0">
                    <h3 class="text-info" id="pendientes">32</h3>
                    <p class="mb-0 fw-bold">Pendientes</p>
                </div>
                <div class="col-md-2 col-6">
                    <h3 class="text-secondary" id="tasaAprobacion">57.1%</h3>
                    <p class="mb-0 fw-bold">Tasa Aprobación</p>
                </div>
            </div>
        </div>

        <!-- Filtros Avanzados -->
        <div class="filter-card fade-in">
            <form method="GET" class="row align-items-end" id="filtrosForm">
                <div class="col-md-2 mb-2">
                    <label class="form-label fw-bold text-white">Estado:</label>
                    <select name="decision" class="form-control form-control-custom" id="filtroEstado">
                        <option value="">Todos</option>
                        <option value="aprobado">Aprobados</option>
                        <option value="rechazado">Rechazados</option>
                        <option value="zona_gris">Zona Gris</option>
                        <option value="en_proceso">En Proceso</option>
                    </select>
                </div>
                <div class="col-md-2 mb-2">
                    <label class="form-label fw-bold text-white">Analista:</label>
                    <select name="analista" class="form-control form-control-custom" id="filtroAnalista">
                        <option value="">Todos</option>
                        <option value="E001">E001 - Juan Pérez</option>
                        <option value="E002">E002 - María García</option>
                        <option value="E003">E003 - Carlos López</option>
                        <option value="E004">E004 - Ana Martínez</option>
                    </select>
                </div>
                <div class="col-md-2 mb-2">
                    <label class="form-label fw-bold text-white">Desde:</label>
                    <input type="date" name="fecha_desde" class="form-control form-control-custom" id="fechaDesde">
                </div>
                <div class="col-md-2 mb-2">
                    <label class="form-label fw-bold text-white">Hasta:</label>
                    <input type="date" name="fecha_hasta" class="form-control form-control-custom" id="fechaHasta">
                </div>
                <div class="col-md-2 mb-2">
                    <label class="form-label fw-bold text-white">Monto Min:</label>
                    <input type="number" name="monto_min" class="form-control form-control-custom" 
                           placeholder="$0" id="montoMin">
                </div>
                <div class="col-md-2 mb-2">
                    <button type="submit" class="btn btn-light w-100">
                        <i class="fas fa-filter me-2"></i>Filtrar
                    </button>
                </div>
            </form>
            
            <div class="row mt-3">
                <div class="col-md-6">
                    <button class="btn btn-outline-light btn-sm me-2" onclick="limpiarFiltros()">
                        <i class="fas fa-times me-1"></i>Limpiar Filtros
                    </button>
                    <button class="btn btn-outline-light btn-sm" onclick="filtrosRapidos()">
                        <i class="fas fa-bolt me-1"></i>Filtros Rápidos
                    </button>
                </div>
                <div class="col-md-6 text-end">
                    <small class="text-white-50" id="contadorResultados">
                        Mostrando 15 de 156 solicitudes
                    </small>
                </div>
            </div>
        </div>

        <!-- Spinner de carga -->
        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-2">Cargando solicitudes...</p>
        </div>

        <!-- Tabla de Solicitudes -->
        <div class="card card-custom fade-in">
            <div class="card-header bg-transparent">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h5 class="mb-0">
                            <i class="fas fa-list me-2"></i>
                            Lista Completa de Solicitudes
                        </h5>
                    </div>
                    <div class="col-md-6 text-end">
                        <button class="btn btn-outline-primary btn-sm me-2" onclick="busquedaRapida()">
                            <i class="fas fa-search me-1"></i>Buscar
                        </button>
                        <button class="btn btn-outline-info btn-sm" onclick="estadisticasRapidas()">
                            <i class="fas fa-chart-pie me-1"></i>Stats
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0" id="tablaSolicitudes">
                        <thead class="table-light">
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                                </th>
                                <th onclick="ordenarPor('numero')" style="cursor: pointer;">
                                    Número <i class="fas fa-sort"></i>
                                </th>
                                <th>Cliente</th>
                                <th>Analista</th>
                                <th>Monto</th>
                                <th>Estado</th>
                                <th>FICO</th>
                                <th>TDSR</th>
                                <th onclick="ordenarPor('fecha')" style="cursor: pointer;">
                                    Fecha <i class="fas fa-sort"></i>
                                </th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaSolicitudesBody">
                            <!-- Datos de ejemplo -->
                            <tr data-solicitud-id="1">
                                <td><input type="checkbox" class="solicitud-checkbox" value="1"></td>
                                <td><span class="badge bg-secondary">SOL-2025-001</span></td>
                                <td>
                                    <strong>Juan Carlos Mendoza</strong><br>
                                    <small class="text-muted">MECJ850715ABC</small>
                                </td>
                                <td>
                                    <span class="analista-badge">E001</span><br>
                                    <small class="text-muted">Juan Pérez</small>
                                </td>
                                <td>
                                    <strong>$75,000</strong><br>
                                    <small class="text-success">Aprob: $45,000</small>
                                </td>
                                <td>
                                    <span class="status-badge status-aprobado">
                                        <i class="fas fa-check me-1"></i>Aprobado
                                    </span>
                                </td>
                                <td><span class="badge bg-success">725</span></td>
                                <td><span class="badge bg-success">28%</span></td>
                                <td>
                                    <small>28/01/2025<br><span class="text-muted">09:30</span></small>
                                </td>
                                <td>
                                    <div class="table-actions">
                                        <button class="btn btn-outline-info btn-sm" title="Ver detalles">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-outline-success btn-sm" title="Ver resultado">
                                            <i class="fas fa-file-alt"></i>
                                        </button>
                                        <button class="btn btn-outline-secondary btn-sm" 
                                                onclick="verHistorial(1)" title="Ver historial">
                                            <i class="fas fa-history"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-solicitud-id="2">
                                <td><input type="checkbox" class="solicitud-checkbox" value="2"></td>
                                <td><span class="badge bg-secondary">SOL-2025-002</span></td>
                                <td>
                                    <strong>María Elena Rodríguez</strong><br>
                                    <small class="text-muted">ROME920315XYZ</small>
                                </td>
                                <td>
                                    <span class="analista-badge">E002</span><br>
                                    <small class="text-muted">María García</small>
                                </td>
                                <td><strong>$120,000</strong></td>
                                <td>
                                    <span class="status-badge status-zona_gris">
                                        <i class="fas fa-exclamation-triangle me-1"></i>Zona Gris
                                    </span>
                                </td>
                                <td><span class="badge bg-warning">670</span></td>
                                <td><span class="badge bg-warning">33%</span></td>
                                <td>
                                    <small>28/01/2025<br><span class="text-muted">10:15</span></small>
                                </td>
                                <td>
                                    <div class="table-actions">
                                        <button class="btn btn-outline-info btn-sm" title="Ver detalles">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-outline-secondary btn-sm" 
                                                onclick="verHistorial(2)" title="Ver historial">
                                            <i class="fas fa-history"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-solicitud-id="3">
                                <td><input type="checkbox" class="solicitud-checkbox" value="3"></td>
                                <td><span class="badge bg-secondary">SOL-2025-003</span></td>
                                <td>
                                    <strong>Roberto Sánchez López</strong><br>
                                    <small class="text-muted">SALR780922DEF</small>
                                </td>
                                <td>
                                    <span class="analista-badge">E001</span><br>
                                    <small class="text-muted">Juan Pérez</small>
                                </td>
                                <td><strong>$50,000</strong></td>
                                <td>
                                    <span class="status-badge status-rechazado">
                                        <i class="fas fa-times me-1"></i>Rechazado
                                    </span>
                                </td>
                                <td><span class="badge bg-danger">580</span></td>
                                <td><span class="badge bg-danger">42%</span></td>
                                <td>
                                    <small>27/01/2025<br><span class="text-muted">16:45</span></small>
                                </td>
                                <td>
                                    <div class="table-actions">
                                        <button class="btn btn-outline-info btn-sm" title="Ver detalles">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-outline-success btn-sm" title="Ver resultado">
                                            <i class="fas fa-file-alt"></i>
                                        </button>
                                        <button class="btn btn-outline-secondary btn-sm" 
                                                onclick="verHistorial(3)" title="Ver historial">
                                            <i class="fas fa-history"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-solicitud-id="4">
                                <td><input type="checkbox" class="solicitud-checkbox" value="4"></td>
                                <td><span class="badge bg-secondary">SOL-2025-004</span></td>
                                <td>
                                    <strong>Andrea Martínez Cruz</strong><br>
                                    <small class="text-muted">MACA901205GHI</small>
                                </td>
                                <td>
                                    <span class="analista-badge">E003</span><br>
                                    <small class="text-muted">Carlos López</small>
                                </td>
                                <td><strong>$85,000</strong></td>
                                <td>
                                    <span class="status-badge status-en_proceso">
                                        <i class="fas fa-clock me-1"></i>En Proceso
                                    </span>
                                </td>
                                <td><span class="badge bg-success">710</span></td>
                                <td><span class="badge bg-success">25%</span></td>
                                <td>
                                    <small>28/01/2025<br><span class="text-muted">11:20</span></small>
                                </td>
                                <td>
                                    <div class="table-actions">
                                        <button class="btn btn-outline-info btn-sm" title="Ver detalles">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-outline-secondary btn-sm" 
                                                onclick="verHistorial(4)" title="Ver historial">
                                            <i class="fas fa-history"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Paginación -->
                <div class="card-footer bg-transparent">
                    <nav aria-label="Paginación de solicitudes">
                        <ul class="pagination justify-content-center mb-0">
                            <li class="page-item">
                                <a class="page-link" href="#" onclick="cambiarPagina(1)">
                                    <i class="fas fa-chevron-left"></i>
                                </a>
                            </li>
                            <li class="page-item active">
                                <span class="page-link">1</span>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#" onclick="cambiarPagina(2)">2</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#" onclick="cambiarPagina(3)">3</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#" onclick="cambiarPagina(2)">
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Acciones Masivas -->
        <div class="card card-custom mt-3" id="accionesMasivas" style="display: none;">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h6 class="mb-0">
                            <i class="fas fa-tasks me-2"></i>
                            Acciones Masivas (<span id="selectedCount">0</span> seleccionadas)
                        </h6>
                    </div>
                    <div class="col-md-6 text-end">
                        <button class="btn btn-outline-primary btn-sm me-2" onclick="exportarSeleccionadas()">
                            <i class="fas fa-download me-1"></i>Exportar
                        </button>
                        <button class="btn btn-outline-info btn-sm me-2" onclick="generarReporteMasivo()">
                            <i class="fas fa-chart-bar me-1"></i>Reporte
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="limpiarSeleccion()">
                            <i class="fas fa-times me-1"></i>Limpiar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Historial -->
    <div class="modal fade" id="historialModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-history me-2"></i>
                        Historial de Solicitud
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="historialContent">
                    <!-- Se llena via JavaScript -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast para notificaciones -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="toastNotification" class="toast" role="alert">
            <div class="toast-header">
                <i class="fas fa-info-circle text-primary me-2"></i>
                <strong class="me-auto">Sistema</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                <!-- Mensaje dinámico -->
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variables globales
        let solicitudesSeleccionadas = [];
        let ordenActual = { campo: null, direccion: 'asc' };

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            actualizarContadores();
            configurarEventListeners();
            // Establecer fecha actual como máximo
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fechaHasta').setAttribute('max', hoy);
        });

        function configurarEventListeners() {
            // Event listeners para checkboxes
            document.querySelectorAll('.solicitud-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', actualizarSeleccion);
            });

            // Event listener para filtros en tiempo real
            document.getElementById('filtrosForm').addEventListener('input', function(e) {
                if (e.target.type !== 'submit') {
                    aplicarFiltrosEnTiempoReal();
                }
            });
        }

        function mostrarToast(mensaje, tipo = 'info') {
            const toast = document.getElementById('toastNotification');
            const toastMessage = document.getElementById('toastMessage');
            const toastHeader = toast.querySelector('.toast-header i');
            
            // Configurar icono según tipo
            const iconos = {
                'success': 'fas fa-check-circle text-success',
                'error': 'fas fa-exclamation-circle text-danger',
                'warning': 'fas fa-exclamation-triangle text-warning',
                'info': 'fas fa-info-circle text-primary'
            };
            
            toastHeader.className = iconos[tipo] || iconos['info'];
            toastMessage.textContent = mensaje;
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }

        function limpiarFiltros() {
            document.getElementById('filtrosForm').reset();
            aplicarFiltrosEnTiempoReal();
            mostrarToast('Filtros limpiados correctamente', 'success');
        }

        function filtrosRapidos() {
            const opciones = [
                { texto: 'Solicitudes de Hoy', accion: () => aplicarFiltroHoy() },
                { texto: 'Solicitudes Pendientes', accion: () => aplicarFiltroEstado('en_proceso') },
                { texto: 'Aprobadas Este Mes', accion: () => aplicarFiltroMesActual('aprobado') },
                { texto: 'Zona Gris', accion: () => aplicarFiltroEstado('zona_gris') },
                { texto: 'Montos Altos (>$100k)', accion: () => aplicarFiltroMonto(100000) }
            ];
            
            let mensaje = 'Seleccione un filtro rápido:\n\n';
            opciones.forEach((opcion, index) => {
                mensaje += `${index + 1}. ${opcion.texto}\n`;
            });
            
            const seleccion = prompt(mensaje + '\nIngrese el número (1-5):');
            if (seleccion && seleccion >= 1 && seleccion <= 5) {
                opciones[seleccion - 1].accion();
                mostrarToast(`Filtro aplicado: ${opciones[seleccion - 1].texto}`, 'info');
            }
        }

        function aplicarFiltroHoy() {
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fechaDesde').value = hoy;
            aplicarFiltrosEnTiempoReal();
        }

        function aplicarFiltroEstado(estado) {
            document.getElementById('filtroEstado').value = estado;
            aplicarFiltrosEnTiempoReal();
        }

        function aplicarFiltroMesActual(estado) {
            const hoy = new Date();
            const primerDia = new Date(hoy.getFullYear(), hoy.getMonth(), 1);
            document.getElementById('fechaDesde').value = primerDia.toISOString().split('T')[0];
            document.getElementById('filtroEstado').value = estado;
            aplicarFiltrosEnTiempoReal();
        }

        function aplicarFiltroMonto(montoMinimo) {
            document.getElementById('montoMin').value = montoMinimo;
            aplicarFiltrosEnTiempoReal();
        }

        function aplicarFiltrosEnTiempoReal() {
            const filtros = {
                estado: document.getElementById('filtroEstado').value,
                analista: document.getElementById('filtroAnalista').value,
                fechaDesde: document.getElementById('fechaDesde').value,
                fechaHasta: document.getElementById('fechaHasta').value,
                montoMin: document.getElementById('montoMin').value
            };

            const filas = document.querySelectorAll('#tablaSolicitudesBody tr');
            let filasMostradas = 0;

            filas.forEach(fila => {
                let mostrar = true;

                // Filtro por estado
                if (filtros.estado) {
                    const estadoFila = fila.querySelector('.status-badge').textContent.toLowerCase();
                    const estadoMap = {
                        'aprobado': 'aprobado',
                        'rechazado': 'rechazado',
                        'zona_gris': 'zona gris',
                        'en_proceso': 'en proceso'
                    };
                    
                    if (!estadoFila.includes(estadoMap[filtros.estado])) {
                        mostrar = false;
                    }
                }

                // Filtro por analista
                if (filtros.analista) {
                    const analistaFila = fila.querySelector('.analista-badge').textContent;
                    if (!analistaFila.includes(filtros.analista)) {
                        mostrar = false;
                    }
                }

                // Filtro por monto mínimo
                if (filtros.montoMin) {
                    const montoText = fila.cells[4].textContent;
                    const montoMatch = montoText.match(/\$[\d,]+/);
                    if (montoMatch) {
                        const monto = parseFloat(montoMatch[0].replace(/[$,]/g, ''));
                        if (monto < parseFloat(filtros.montoMin)) {
                            mostrar = false;
                        }
                    }
                }

                // Mostrar/ocultar fila
                fila.style.display = mostrar ? '' : 'none';
                if (mostrar) filasMostradas++;
            });

            // Actualizar contador
            document.getElementById('contadorResultados').textContent = 
                `Mostrando ${filasMostradas} de ${filas.length} solicitudes`;

            actualizarContadores();
        }

        function ordenarPor(campo) {
            const tbody = document.getElementById('tablaSolicitudesBody');
            const filas = Array.from(tbody.querySelectorAll('tr')).filter(fila => 
                fila.style.display !== 'none'
            );

            // Cambiar dirección si es el mismo campo
            if (ordenActual.campo === campo) {
                ordenActual.direccion = ordenActual.direccion === 'asc' ? 'desc' : 'asc';
            } else {
                ordenActual.campo = campo;
                ordenActual.direccion = 'asc';
            }

            filas.sort((a, b) => {
                let valorA, valorB;

                switch (campo) {
                    case 'numero':
                        valorA = a.cells[1].textContent.trim();
                        valorB = b.cells[1].textContent.trim();
                        break;
                    case 'fecha':
                        valorA = new Date(a.cells[8].textContent.split('\n')[0].split('/').reverse().join('-'));
                        valorB = new Date(b.cells[8].textContent.split('\n')[0].split('/').reverse().join('-'));
                        break;
                    default:
                        return 0;
                }

                if (valorA < valorB) return ordenActual.direccion === 'asc' ? -1 : 1;
                if (valorA > valorB) return ordenActual.direccion === 'asc' ? 1 : -1;
                return 0;
            });

            // Reorganizar las filas
            filas.forEach(fila => tbody.appendChild(fila));

            mostrarToast(`Tabla ordenada por ${campo} (${ordenActual.direccion})`, 'info');
        }

        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.solicitud-checkbox');
            
            checkboxes.forEach(checkbox => {
                const fila = checkbox.closest('tr');
                if (fila.style.display !== 'none') {
                    checkbox.checked = selectAll.checked;
                }
            });
            
            actualizarSeleccion();
        }

        function actualizarSeleccion() {
            const checkboxes = document.querySelectorAll('.solicitud-checkbox:checked');
            const count = checkboxes.length;
            
            document.getElementById('selectedCount').textContent = count;
            document.getElementById('accionesMasivas').style.display = count > 0 ? 'block' : 'none';
            
            solicitudesSeleccionadas = Array.from(checkboxes).map(cb => cb.value);

            // Efecto visual en filas seleccionadas
            document.querySelectorAll('.solicitud-checkbox').forEach(checkbox => {
                const fila = checkbox.closest('tr');
                if (checkbox.checked) {
                    fila.style.backgroundColor = 'rgba(102,126,234,0.1)';
                } else {
                    fila.style.backgroundColor = '';
                }
            });
        }

        function limpiarSeleccion() {
            document.querySelectorAll('.solicitud-checkbox').forEach(cb => {
                cb.checked = false;
                cb.closest('tr').style.backgroundColor = '';
            });
            document.getElementById('selectAll').checked = false;
            actualizarSeleccion();
            mostrarToast('Selección limpiada', 'info');
        }

        function verHistorial(solicitudId) {
            const historiales = {
                1: `
                    <div class="timeline">
                        <div class="timeline-item">
                            <strong>Solicitud Creada</strong><br>
                            <small class="text-muted">28/01/2025 09:30 - Analista E001</small>
                            <p class="mb-1">Solicitud registrada en el sistema por Juan Pérez</p>
                        </div>
                        <div class="timeline-item">
                            <strong>Documentos Validados</strong><br>
                            <small class="text-muted">28/01/2025 10:15 - Analista E001</small>
                            <p class="mb-1">Todos los documentos validados correctamente</p>
                        </div>
                        <div class="timeline-item">
                            <strong>Scoring Calculado</strong><br>
                            <small class="text-muted">28/01/2025 10:20 - Sistema</small>
                            <p class="mb-1">Score total: 340/450 puntos</p>
                        </div>
                        <div class="timeline-item">
                            <strong>Decisión Tomada</strong><br>
                            <small class="text-muted">28/01/2025 10:25 - Analista E001</small>
                            <p class="mb-1">Solicitud aprobada por $45,000</p>
                        </div>
                    </div>
                `,
                2: `
                    <div class="timeline">
                        <div class="timeline-item">
                            <strong>Solicitud Creada</strong><br>
                            <small class="text-muted">28/01/2025 10:15 - Analista E002</small>
                            <p class="mb-1">Solicitud registrada por María García</p>
                        </div>
                        <div class="timeline-item">
                            <strong>Documentos en Revisión</strong><br>
                            <small class="text-muted">28/01/2025 11:00 - Analista E002</small>
                            <p class="mb-1">Falta comprobante de ingresos actualizado</p>
                        </div>
                        <div class="timeline-item">
                            <strong>Evaluación Adicional</strong><br>
                            <small class="text-muted">28/01/2025 11:30 - Sistema</small>
                            <p class="mb-1">Solicitud enviada a zona gris por TDSR límite</p>
                        </div>
                    </div>
                `,
                3: `
                    <div class="timeline">
                        <div class="timeline-item">
                            <strong>Solicitud Creada</strong><br>
                            <small class="text-muted">27/01/2025 16:45 - Analista E001</small>
                            <p class="mb-1">Solicitud registrada en el sistema</p>
                        </div>
                        <div class="timeline-item">
                            <strong>Scoring Calculado</strong><br>
                            <small class="text-muted">27/01/2025 17:00 - Sistema</small>
                            <p class="mb-1">Score total: 180/450 puntos</p>
                        </div>
                        <div class="timeline-item">
                            <strong>Decisión Tomada</strong><br>
                            <small class="text-muted">27/01/2025 17:05 - Analista E001</small>
                            <p class="mb-1">Solicitud rechazada por score bajo y alta relación deuda-ingresos</p>
                        </div>
                    </div>
                `,
                4: `
                    <div class="timeline">
                        <div class="timeline-item">
                            <strong>Solicitud Creada</strong><br>
                            <small class="text-muted">28/01/2025 11:20 - Analista E003</small>
                            <p class="mb-1">Solicitud registrada por Carlos López</p>
                        </div>
                        <div class="timeline-item">
                            <strong>En Proceso de Análisis</strong><br>
                            <small class="text-muted">28/01/2025 11:45 - Analista E003</small>
                            <p class="mb-1">Revisando documentación financiera</p>
                        </div>
                    </div>
                `
            };
            
            document.getElementById('historialContent').innerHTML = 
                historiales[solicitudId] || '<p>No hay historial disponible.</p>';
            
            const modal = new bootstrap.Modal(document.getElementById('historialModal'));
            modal.show();
        }

        function exportarDatos() {
            const formatos = [
                { nombre: 'Excel (.xlsx)', extension: 'xlsx', icono: 'fas fa-file-excel' },
                { nombre: 'CSV (.csv)', extension: 'csv', icono: 'fas fa-file-csv' },
                { nombre: 'PDF (.pdf)', extension: 'pdf', icono: 'fas fa-file-pdf' },
                { nombre: 'JSON (.json)', extension: 'json', icono: 'fas fa-file-code' }
            ];
            
            let mensaje = 'Seleccione el formato de exportación:\n\n';
            formatos.forEach((formato, index) => {
                mensaje += `${index + 1}. ${formato.nombre}\n`;
            });
            
            const seleccion = prompt(mensaje + '\nIngrese el número (1-4):');
            if (seleccion && seleccion >= 1 && seleccion <= 4) {
                const formato = formatos[seleccion - 1];
                mostrarSpinner(true);
                
                setTimeout(() => {
                    mostrarSpinner(false);
                    mostrarToast(`Exportación iniciada en formato ${formato.extension.toUpperCase()}`, 'success');
                    
                    // Simular descarga
                    const link = document.createElement('a');
                    link.download = `solicitudes_${new Date().toISOString().split('T')[0]}.${formato.extension}`;
                    link.href = '#';
                    link.click();
                }, 2000);
            }
        }

        function exportarSeleccionadas() {
            if (solicitudesSeleccionadas.length === 0) {
                mostrarToast('Seleccione al menos una solicitud para exportar.', 'warning');
                return;
            }
            
            mostrarSpinner(true);
            setTimeout(() => {
                mostrarSpinner(false);
                mostrarToast(`Exportando ${solicitudesSeleccionadas.length} solicitudes seleccionadas`, 'success');
            }, 1500);
        }

        function generarReporteMasivo() {
            if (solicitudesSeleccionadas.length === 0) {
                mostrarToast('Seleccione al menos una solicitud para generar el reporte.', 'warning');
                return;
            }
            
            if (confirm(`¿Generar reporte consolidado de ${solicitudesSeleccionadas.length} solicitudes?`)) {
                mostrarSpinner(true);
                setTimeout(() => {
                    mostrarSpinner(false);
                    mostrarToast('Reporte consolidado generado exitosamente', 'success');
                }, 2500);
            }
        }

        function busquedaRapida() {
            const termino = prompt('Buscar por número, cliente, RFC o analista:');
            if (!termino) return;

            const filas = document.querySelectorAll('#tablaSolicitudesBody tr');
            let encontrados = 0;
            
            // Limpiar búsquedas anteriores
            filas.forEach(fila => {
                fila.classList.remove('search-highlight');
                fila.style.display = '';
            });

            filas.forEach(fila => {
                const texto = fila.textContent.toLowerCase();
                if (texto.includes(termino.toLowerCase())) {
                    fila.classList.add('search-highlight');
                    encontrados++;
                } else {
                    fila.style.display = 'none';
                }
            });
            
            if (encontrados === 0) {
                mostrarToast(`No se encontraron resultados para: "${termino}"`, 'warning');
                filas.forEach(fila => {
                    fila.style.display = '';
                });
            } else {
                mostrarToast(`Se encontraron ${encontrados} resultados para: "${termino}"`, 'success');
                
                // Scroll al primer resultado
                const primerResultado = document.querySelector('.search-highlight');
                if (primerResultado) {
                    primerResultado.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            // Actualizar contador
            document.getElementById('contadorResultados').textContent = 
                `Mostrando ${encontrados} de ${filas.length} solicitudes`;
        }

        function estadisticasRapidas() {
            const filas = document.querySelectorAll('#tablaSolicitudesBody tr:not([style*="display: none"])');
            const stats = {
                total: filas.length,
                aprobadas: 0,
                rechazadas: 0,
                pendientes: 0,
                zonaGris: 0,
                montoTotal: 0,
                montoPromedio: 0
            };
            
            filas.forEach(fila => {
                const estado = fila.querySelector('.status-badge').textContent.trim().toLowerCase();
                
                if (estado.includes('aprobado')) stats.aprobadas++;
                else if (estado.includes('rechazado')) stats.rechazadas++;
                else if (estado.includes('zona gris')) stats.zonaGris++;
                else stats.pendientes++;
                
                const montoCell = fila.cells[4].textContent;
                const montoMatch = montoCell.match(/\$[\d,]+/);
                if (montoMatch) {
                    const monto = parseFloat(montoMatch[0].replace(/[$,]/g, ''));
                    if (!isNaN(monto)) stats.montoTotal += monto;
                }
            });
            
            stats.montoPromedio = stats.total > 0 ? stats.montoTotal / stats.total : 0;
            const tasaAprobacion = stats.total > 0 ? ((stats.aprobadas / stats.total) * 100).toFixed(1) : 0;
            
            const mensaje = `📊 ESTADÍSTICAS DE LA VISTA ACTUAL

📋 SOLICITUDES:
• Total: ${stats.total}
• Aprobadas: ${stats.aprobadas} (${tasaAprobacion}%)
• Rechazadas: ${stats.rechazadas}
• Zona Gris: ${stats.zonaGris}
• Pendientes: ${stats.pendientes}

💰 MONTOS:
• Total solicitado: ${stats.montoTotal.toLocaleString()}
• Promedio por solicitud: ${Math.round(stats.montoPromedio).toLocaleString()}

📈 RENDIMIENTO:
• Tasa de aprobación: ${tasaAprobacion}%
• Eficiencia de procesamiento: ${((stats.total - stats.pendientes) / stats.total * 100).toFixed(1)}%`;

            alert(mensaje);
        }

        function cambiarPagina(pagina) {
            mostrarSpinner(true);
            setTimeout(() => {
                mostrarSpinner(false);
                mostrarToast(`Cargando página ${pagina}`, 'info');
            }, 800);
        }

        function actualizarContadores() {
            const filas = document.querySelectorAll('#tablaSolicitudesBody tr:not([style*="display: none"])');
            let aprobadas = 0, rechazadas = 0, pendientes = 0, zonaGris = 0;

            filas.forEach(fila => {
                const estado = fila.querySelector('.status-badge').textContent.toLowerCase();
                if (estado.includes('aprobado')) aprobadas++;
                else if (estado.includes('rechazado')) rechazadas++;
                else if (estado.includes('zona gris')) zonaGris++;
                else pendientes++;
            });

            const total = filas.length;
            const tasaAprobacion = total > 0 ? ((aprobadas / total) * 100).toFixed(1) : 0;

            // Actualizar contadores con animación
            animarContador('totalSolicitudes', total);
            animarContador('aprobadas', aprobadas);
            animarContador('rechazadas', rechazadas);
            animarContador('zonaGris', zonaGris);
            animarContador('pendientes', pendientes);
            document.getElementById('tasaAprobacion').textContent = `${tasaAprobacion}%`;
        }

        function animarContador(elementoId, valorFinal) {
            const elemento = document.getElementById(elementoId);
            const valorInicial = parseInt(elemento.textContent) || 0;
            const duracion = 1000; // 1 segundo
            const incremento = (valorFinal - valorInicial) / (duracion / 16);
            let valorActual = valorInicial;

            const timer = setInterval(() => {
                valorActual += incremento;
                if ((incremento > 0 && valorActual >= valorFinal) || 
                    (incremento < 0 && valorActual <= valorFinal)) {
                    elemento.textContent = valorFinal;
                    clearInterval(timer);
                } else {
                    elemento.textContent = Math.round(valorActual);
                }
            }, 16);
        }

        function mostrarSpinner(mostrar) {
            const spinner = document.getElementById('loadingSpinner');
            const tabla = document.querySelector('.table-responsive');
            
            if (mostrar) {
                spinner.style.display = 'block';
                tabla.style.opacity = '0.5';
            } else {
                spinner.style.display = 'none';
                tabla.style.opacity = '1';
            }
        }

        // Función para limpiar resaltado de búsqueda
        function limpiarBusqueda() {
            document.querySelectorAll('#tablaSolicitudesBody tr').forEach(fila => {
                fila.classList.remove('search-highlight');
                fila.style.display = '';
            });
            
            const total = document.querySelectorAll('#tablaSolicitudesBody tr').length;
            document.getElementById('contadorResultados').textContent = 
                `Mostrando ${total} de ${total} solicitudes`;
            
            mostrarToast('Búsqueda limpiada', 'info');
        }

        // Atajos de teclado
        document.addEventListener('keydown', function(e) {
            // Ctrl + F para búsqueda rápida
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                busquedaRapida();
            }
            
            // Escape para limpiar búsqueda
            if (e.key === 'Escape') {
                limpiarBusqueda();
            }
            
            // Ctrl + A para seleccionar todo
            if (e.ctrlKey && e.key === 'a' && document.activeElement.tagName !== 'INPUT') {
                e.preventDefault();
                document.getElementById('selectAll').checked = true;
                toggleSelectAll();
            }
        });

        // Auto-guardar filtros en localStorage (simulado)
        function guardarFiltros() {
            const filtros = {
                estado: document.getElementById('filtroEstado').value,
                analista: document.getElementById('filtroAnalista').value,
                fechaDesde: document.getElementById('fechaDesde').value,
                fechaHasta: document.getElementById('fechaHasta').value,
                montoMin: document.getElementById('montoMin').value
            };
            
            console.log('Filtros guardados:', filtros);
            // En un entorno real, aquí se guardarían en localStorage
        }

        // Cargar filtros guardados al iniciar
        function cargarFiltrosGuardados() {
            // En un entorno real, aquí se cargarían desde localStorage
            console.log('Cargando filtros guardados...');
        }

        // Inicialización adicional
        setTimeout(() => {
            cargarFiltrosGuardados();
        }, 500);
    </script>
</body>
</html>
